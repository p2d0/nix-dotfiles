# Do not modify this file!  It was generated by ‘nixos-generate-config’
# and may be overwritten by future invocations.  Please make changes
# to /etc/nixos/configuration.nix instead.
{ config, lib, pkgs, modulesPath, ... }:

{
  imports =
    [ (modulesPath + "/installer/scan/not-detected.nix")
    ];

  boot.initrd.availableKernelModules = [ "ehci_pci" "ata_piix" "usb_storage" "usbhid" "sd_mod" ];
  boot.initrd.kernelModules = [ ];
  boot.kernelModules = [ "vfio-pci" "nvidia_uvm" ];
  boot.kernelParams = [ # "quiet" "vga=current" "udev.log_level=3" "rd.systemd.show_status=auto" "nowatchdog"
    # "amdgpu.ppfeaturemask=0xffffffff"
    # "nvidia.NVreg_EnableGpuFirmware=0"
    "usbhid.mousepoll=1"   "raid0.default_layout=2" ];
  # boot.loader.timeout = 1;
  services.fstrim.enable = lib.mkDefault true;
  # hardware.hidpi.enable = true;

  fileSystems."/" =
    { device = "/dev/nvme0n1p2";
      # options = [ "noatime" ];
      fsType = "ext4";
    };

  fileSystems."/boot/efi" =
    { device = "/dev/nvme0n1p1";
      fsType = "vfat";
      options = [ "defaults" ];
    };

  fileSystems."/mnt/old" =
    { device = "/dev/disk/by-uuid/a8b905b6-7e2d-4274-b974-f460aeabdab7";
      options = [ "noatime" ];
      fsType = "ext4";
    };

  fileSystems."/mnt/new" =
    { device = "/dev/disk/by-uuid/e7b71064-63c1-4f01-9bef-b961ed405b97";
      options = [ "noatime" ];
      fsType = "ext4";
    };

  # TODO fix permissions
  # https://superuser.com/questions/174776/modify-fstab-entry-so-all-users-can-read-and-write-to-an-ext4-volume
  fileSystems."/mnt/md127" =
    { device = "/dev/md127";
      options = [ "noatime" ];
      fsType = "ext4";
    };

  swapDevices = [
    {
      device = "/dev/disk/by-uuid/6461bae0-3f65-4d32-9a2f-696b57250ab2";
      # size = 96*1024;
    }
    {
      device = "/swapfile2";
      size = 16 * 1024;
    }
  ];

  # Enables DHCP on each ethernet and wireless interface. In case of scripted networking
  # (the default) this is the recommended approach. When using systemd-networkd it's
  # still possible to use this option, but it's recommended to use it in conjunction
  # with explicit per-interface declarations with `networking.interfaces.<interface>.useDHCP`.
  networking.useDHCP = true;
  # networking.interfaces.enp3s0.useDHCP = true;
  networking.enableIPv6 = true;

  # hardware.cpu.intel.updateMicrocode = lib.mkDefault config.hardware.enableRedistributableFirmware;
}
